<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-06-04 Do 22:13 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>The beans manual</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Silvio BÃ¶hler" />
<meta name="description" content="Plain-text accounting using beans"
 />
<meta name="keywords" content="plain-text accounting, beans, ledger, hledger, beancount, ledger-cli, accounting, money, personal finance" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/styles/readtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/styles/readtheorg/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/styles/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/styles/readtheorg/js/readtheorg.js"></script>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:1f739d935676111cfff4b4693e3816e664797050&amp;dn=gpl-3.0.txt GPL-v3-or-Later
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.cacheClassElem = elem.className;
         elem.cacheClassTarget = target.className;
         target.className = "code-highlighted";
         elem.className   = "code-highlighted";
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(elem.cacheClassElem)
         elem.className = elem.cacheClassElem;
       if(elem.cacheClassTarget)
         target.className = elem.cacheClassTarget;
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href=""> UP </a>
 |
 <a accesskey="H" href="https://sboehler.github.io/beans"> HOME </a>
</div><div id="content">
<h1 class="title">The beans manual</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org7c3324b">1. About beans</a>
<ul>
<li><a href="#org865d9d4">1.1. Project goals</a>
<ul>
<li><a href="#org71c2dc2">1.1.1. Built-in file importers</a></li>
<li><a href="#orgca9d939">1.1.2. Automatic categorization</a></li>
<li><a href="#orgcd34387">1.1.3. <code>beans</code> always balances</a></li>
<li><a href="#orgca963d2">1.1.4. Transcode to beancount</a></li>
<li><a href="#org27cdf30">1.1.5. Simple implementation</a></li>
</ul>
</li>
<li><a href="#orgda21ad7">1.2. Changes (if you used a previous version)</a></li>
</ul>
</li>
<li><a href="#orgd915891">2. Getting beans</a>
<ul>
<li><a href="#org3d07f67">2.1. Obtaining the source</a></li>
<li><a href="#orga3e8871">2.2. Installing beans</a>
<ul>
<li><a href="#orgdbdf132">2.2.1. Using Stack</a></li>
<li><a href="#org2434d35">2.2.2. Using Nix</a></li>
<li><a href="#orgc9beb68">2.2.3. Using Cabal</a></li>
</ul>
</li>
<li><a href="#orgc2b2461">2.3. Getting help</a></li>
</ul>
</li>
<li><a href="#org6257a50">3. Working with beans</a>
<ul>
<li><a href="#orgf6f80e9">3.1. Importing data</a>
<ul>
<li><a href="#org0768525">3.1.1. Importers</a></li>
<li><a href="#orgcd820e3">3.1.2. Importing data</a></li>
<li><a href="#org7c43e03">3.1.3. Assigning accounts</a></li>
</ul>
</li>
<li><a href="#org69971e4">3.2. Creating a journal</a>
<ul>
<li><a href="#org6efb15e">3.2.1. Journal files</a></li>
<li><a href="#orgdb1ac4e">3.2.2. Conventions</a></li>
</ul>
</li>
<li><a href="#org1499d20">3.3. Balancing</a>
<ul>
<li><a href="#orgfd2c418">3.3.1. Global balance</a></li>
<li><a href="#org05dc090">3.3.2. Balancing options</a></li>
</ul>
</li>
<li><a href="#orgfcd34fe">3.4. Transaction-level valuation</a></li>
</ul>
</li>
<li><a href="#orgefc2788">4. Developing beans</a>
<ul>
<li><a href="#orgd8a6da9">4.1. Roadmap</a>
<ul>
<li><a href="#orgacd6c94">4.1.1. Shorter term</a></li>
<li><a href="#orgcb991d2">4.1.2. Longer term</a></li>
</ul>
</li>
<li><a href="#org02dbe78">4.2. Documentation</a></li>
<li><a href="#org85c3215">4.3. Dev setup</a>
<ul>
<li><a href="#org976e2aa">4.3.1. nix / Haskell IDE engine</a></li>
<li><a href="#org70f6d49">4.3.2. Stack</a></li>
</ul>
</li>
<li><a href="#org0392c3c">4.4. Adding an importer</a></li>
<li><a href="#org03c641e">4.5. Tests</a></li>
</ul>
</li>
<li><a href="#orgb33a99d">5. License</a></li>
</ul>
</div>
</div>

<div id="outline-container-org7c3324b" class="outline-2">
<h2 id="org7c3324b"><span class="section-number-2">1</span> About beans</h2>
<div class="outline-text-2" id="text-1">
<p>
beans is a <a href="https://plaintextaccounting.org">plain text accounting tool</a> in the tradition of <a href="https://www.ledger-cli.org">ledger</a>,
<a href="https://hledger.org">hledger</a> and <a href="https://furius.ca/beancount/">beancount</a>.
</p>
</div>

<div id="outline-container-org865d9d4" class="outline-3">
<h3 id="org865d9d4"><span class="section-number-3">1.1</span> Project goals</h3>
<div class="outline-text-3" id="text-1-1">
</div>
<div id="outline-container-org71c2dc2" class="outline-4">
<h4 id="org71c2dc2"><span class="section-number-4">1.1.1</span> Built-in file importers</h4>
<div class="outline-text-4" id="text-1-1-1">
<p>
The greatest pain of plain text accounting is to import financial
statements from financial service providers such as banks and credit
cards. <code>beans</code> strives to include <a href="#orgff8dfd3">importers</a> for known formats.
</p>
</div>
</div>

<div id="outline-container-orgca9d939" class="outline-4">
<h4 id="orgca9d939"><span class="section-number-4">1.1.2</span> Automatic categorization</h4>
<div class="outline-text-4" id="text-1-1-2">
<p>
<code>beans</code> provides a Bayesien inference (machine learning) engine to
automatically assign accounts based on your existing ledger.
</p>
</div>
</div>

<div id="outline-container-orgcd34387" class="outline-4">
<h4 id="orgcd34387"><span class="section-number-4">1.1.3</span> <code>beans</code> always balances</h4>
<div class="outline-text-4" id="text-1-1-3">
<p>
<code>beans</code> aims to make it simple to do at-market valuations of your
assets, while maintaining correctness of the balance. Instead of
converting aggregated account data and adding valuation as an
afterthought, <code>beans</code> applies valuation directly at the transaction
level. For example, if you choose to display a balance at market
prices, <code>beans</code> will transparently insert valuation transactions to
reflect gains and losses due to price changes.
</p>
</div>
</div>

<div id="outline-container-orgca963d2" class="outline-4">
<h4 id="orgca963d2"><span class="section-number-4">1.1.4</span> Transcode to beancount</h4>
<div class="outline-text-4" id="text-1-1-4">
<p>
Translate your beans journal into a beancount-compatible format to
make use of the great tooling universe of beancount, such as the Fava
web interface.
</p>
</div>
</div>

<div id="outline-container-org27cdf30" class="outline-4">
<h4 id="org27cdf30"><span class="section-number-4">1.1.5</span> Simple implementation</h4>
<div class="outline-text-4" id="text-1-1-5">
<p>
<code>beans</code> is written in <a href="https://haskell-lang.org/">Haskell</a>, an excellent language for concise and
beautiful code. Also, while <code>beans</code> adopts concepts from other tools,
compatiblity is not an objective.
</p>
</div>
</div>
</div>

<div id="outline-container-orgda21ad7" class="outline-3">
<h3 id="orgda21ad7"><span class="section-number-3">1.2</span> Changes (if you used a previous version)</h3>
<div class="outline-text-3" id="text-1-2">
<ul class="org-ul">
<li>The previous rules engine got replaced by a Bayesian inference
mechanism, which in practice is much less work.</li>
<li>The file format changed: no more indentation, for friendlier editing</li>
<li>Multi-column reports</li>
<li>Some more importers</li>
<li>Lots of changes under the hood</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgd915891" class="outline-2">
<h2 id="orgd915891"><span class="section-number-2">2</span> Getting beans</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org3d07f67" class="outline-3">
<h3 id="org3d07f67"><span class="section-number-3">2.1</span> Obtaining the source</h3>
<div class="outline-text-3" id="text-2-1">
<p>
<code>beans</code>' source code can be found on <a href="https://github.com/sboehler/beans">github</a>. For the moment, you have
to build from source.
</p>

<p>
Make sure you have git installed and run:
</p>

<pre class="example">
git clone https://github.com/sboehler/beans.git
</pre>
</div>
</div>

<div id="outline-container-orga3e8871" class="outline-3">
<h3 id="orga3e8871"><span class="section-number-3">2.2</span> Installing beans</h3>
<div class="outline-text-3" id="text-2-2">
</div>
<div id="outline-container-orgdbdf132" class="outline-4">
<h4 id="orgdbdf132"><span class="section-number-4">2.2.1</span> Using Stack</h4>
<div class="outline-text-4" id="text-2-2-1">
<p>
<code>stack</code> is probably the easiest option on most platforms to get
started quickly. First, follow the instructions <a href="https://docs.haskellstack.org/en/stable/README/">here</a> to install <code>stack</code>
for your platform. Then:
</p>

<pre class="example">
cd beans
stack install
</pre>

<p>
This will install the <code>beans</code> binary in <code>$HOME/.local/bin/beans</code>. Add this
directory to your path and you're good to go:
</p>

<pre class="example">
export PATH=~/.local/bin:$PATH
</pre>

<p>
Please file a bug if you encounter problems using <code>stack</code>.
</p>
</div>
</div>

<div id="outline-container-org2434d35" class="outline-4">
<h4 id="org2434d35"><span class="section-number-4">2.2.2</span> Using Nix</h4>
<div class="outline-text-4" id="text-2-2-2">
<p>
Make sure you have the <a href="https://nixos.org/nix/">nix package manager</a> installed for your
platform. Then:
</p>

<pre class="example">
cd beans
nix-build --attr beans release.nix
</pre>

<p>
The beans binary will be made available locally in <code>./result/bin/beans</code>
and can be run from there. I am using nix to develop <code>beans</code>, so this
option is the one that is supported best.
</p>
</div>
</div>

<div id="outline-container-orgc9beb68" class="outline-4">
<h4 id="orgc9beb68"><span class="section-number-4">2.2.3</span> Using Cabal</h4>
<div class="outline-text-4" id="text-2-2-3">
<p>
If you intend to develop beans or run the test suite. Make sure cabal
and hpack are installed:
</p>

<pre class="example">
cd beans
cabal new-build
</pre>

<p>
The beans binary will be made available in ./dist/build/beans/beans
and can be run from there.
</p>
</div>
</div>
</div>

<div id="outline-container-orgc2b2461" class="outline-3">
<h3 id="orgc2b2461"><span class="section-number-3">2.3</span> Getting help</h3>
<div class="outline-text-3" id="text-2-3">
<p>
This guide is incomplete and might be out of date. To get an overview
of your possibilities, <code>beans</code> has a built-in help command:
</p>

<div class="org-src-container">
<pre class="src src-sh">beans --help
</pre>
</div>

<pre class="example">
beans

Usage: beans COMMAND
  A plain text accounting tool

Available options:
  -h,--help                Show this help text

Available commands:
  balance                  Print a generic balance
  fetch                    Fetch latest prices
  import                   Import transactions
  infer                    Infer accounts
  transcode                Transcode to beancount
</pre>
</div>
</div>
</div>

<div id="outline-container-org6257a50" class="outline-2">
<h2 id="org6257a50"><span class="section-number-2">3</span> Working with beans</h2>
<div class="outline-text-2" id="text-3">
<p>
<code>beans</code> is a command line tool and has some self-documenting
features. Run the following command to get started:
</p>

<div class="org-src-container">
<pre class="src src-sh" id="orga5a751e">beans --help
</pre>
</div>

<pre class="example">
beans

Usage: beans COMMAND
  A plain text accounting tool

Available options:
  -h,--help                Show this help text

Available commands:
  balance                  Print a generic balance
  fetch                    Fetch latest prices
  import                   Import transactions
  infer                    Infer accounts
  transcode                Transcode to beancount
</pre>

<p>
Use <code>beans &lt;command&gt; --help</code> to get further help on available options.
</p>
</div>

<div id="outline-container-orgf6f80e9" class="outline-3">
<h3 id="orgf6f80e9"><span class="section-number-3">3.1</span> Importing data</h3>
<div class="outline-text-3" id="text-3-1">
<p>
beans offers assistance with importing bank account statements, the
most tiring process in plain text accounting.
</p>
</div>

<div id="outline-container-org0768525" class="outline-4">
<h4 id="org0768525"><span class="section-number-4">3.1.1</span> <a id="orgff8dfd3"></a>Importers</h4>
<div class="outline-text-4" id="text-3-1-1">
<p>
In a first step, bank account statements need to be parsed. The
following is what a statement from my bank might look like.
</p>

<pre class="example">
Datum von:;2017-05-23
Buchungsart:;Alle Buchungen
Konto:;CHXXXXXXXXXXXXXXXXXXX
WÃ¤hrung:;CHF
Buchungsdatum;Avisierungstext;Gutschrift;Lastschrift;Valuta;Saldo
2017-06-01;"Acme Corp";;-135.00;2017-06-01;
2017-05-31;"FOOBAR COMMUNICATIONS";;-52.60;2017-05-31;
2017-05-29;"Transfer 01-45-06 Bigbank";;-1040.00;2017-05-29;36096.54
2017-05-26;"Cleaning Service";;-300.00;2017-05-24;37136.54
2017-05-26;"Supermarket Fine Foods";;-115.20;2017-05-26;
2017-05-26;"Bank Nextgen ";;-250.00;2017-05-26;
2017-05-26;"Tire Car Sales";;-95.85;2017-05-26;

Disclaimer:
Dies ist kein durch PostFinance AG erstelltes Dokument. PostFinance AG ist nicht verantwortlich fÃ¼r den Inhalt.
</pre>

<p>
This is a kind of a CSV format, but then not really, so this is
difficult to parse with a general parser.  <code>beans</code> strives to have
built-in support for as many file formats as possible. Currently, the
following parsers are available:
</p>

<ul class="org-ul">
<li>us.interactivebrokers</li>
<li>ch.postfinance</li>
<li>ch.supercardplus</li>
<li>ch.cumulus</li>
<li>ch.swissquote</li>
</ul>
</div>
</div>

<div id="outline-container-orgcd820e3" class="outline-4">
<h4 id="orgcd820e3"><span class="section-number-4">3.1.2</span> Importing data</h4>
<div class="outline-text-4" id="text-3-1-2">
<p>
If you are lucky enough that the format of your bank is supported,
converting the bank account statement to transactions is a simple
command:
</p>

<div class="org-src-container">
<pre class="src src-sh" id="orgf6d6c0a">beans import -i ch.postfinance -a Assets:Checking examples/postfinance.csv
</pre>
</div>

<p>
<code>import</code> outputs a simple list of transactions to stdout, in a format
parseable by <code>beans</code> and with unknown accounts marked as TBD. It is up to the
user to pipe them into a journal or a temporary file for further
editing.
</p>

<pre class="example">
2017-05-26 "Cleaning Service"
Assets:Checking -300 CHF
TBD 300 CHF

2017-05-26 "Supermarket Fine Foods"
Assets:Checking -115.2 CHF
TBD 115.2 CHF

2017-05-26 "Bank Nextgen "
Assets:Checking -250 CHF
TBD 250 CHF

2017-05-26 "Tire Car Sales"
Assets:Checking -95.85 CHF
TBD 95.85 CHF

2017-05-29 "Transfer 01-45-06 Bigbank"
Assets:Checking -1040 CHF
TBD 1040 CHF

2017-05-31 "FOOBAR COMMUNICATIONS"
Assets:Checking -52.6 CHF
TBD 52.6 CHF

2017-06-01 "Acme Corp"
Assets:Checking -135 CHF
TBD 135 CHF
</pre>
</div>
</div>

<div id="outline-container-org7c43e03" class="outline-4">
<h4 id="org7c43e03"><span class="section-number-4">3.1.3</span> Assigning accounts</h4>
<div class="outline-text-4" id="text-3-1-3">
<p>
Previous version of <code>beans</code> used to feature a DSL to specify rules,
but this still involved too much thinking and writing.
</p>

<p>
<code>beans</code> now has a built-in Bayesien inference (a.k.a. machine
learning) tool. Run <code>beans infer</code> to automatically replace TBD
accounts in a target file based on the existing transactions in your
ledger. Sounds magic, but works very well in practice. You need to get
it started by assigning accounts manually for a few weeks.
</p>
</div>
</div>
</div>

<div id="outline-container-org69971e4" class="outline-3">
<h3 id="org69971e4"><span class="section-number-3">3.2</span> Creating a journal</h3>
<div class="outline-text-3" id="text-3-2">
</div>
<div id="outline-container-org6efb15e" class="outline-4">
<h4 id="org6efb15e"><span class="section-number-4">3.2.1</span> Journal files</h4>
<div class="outline-text-4" id="text-3-2-1">
<p>
Most commands in beans are based on a journal. beans journals uses a
format largely similar to beancount, with the exception that <code>beans</code>
neither requires nor allows indentation:
</p>

<pre class="example">
; -*- mode: Org; eval: (beancount-mode 1); -*-

option "operating_currency" "USD"

** Accounts

2018-01-01 open Equity:Valuation
2018-01-01 open Equity:Val
2018-01-01 open Equity:OpeningBalance
2018-01-01 open Income:Salary
2018-01-01 open Expenses:Rent
2018-01-01 open Expenses:Groceries
2018-01-01 open Expenses:Books
2018-01-01 open Equity:Gains

2018-01-01 open Assets:Checking
2018-01-01 open Assets:Portfolio
2018-01-01 open Assets:Wallet

** Some Transactions

*** Initial balances

2018-01-01 "Opening balance"
Assets:Checking 15000 USD
Equity:OpeningBalance


*** Checking account

2018-01-02 "Rent January"
Assets:Checking -2000 USD
Expenses:Rent

2018-01-10 "Food"
Assets:Checking -300 USD
Expenses:Groceries

2018-01-25 "Salary January"
Assets:Checking 4000 USD
Income:Salary

2018-02-01 "Rent February"
Assets:Checking -2000 USD
Expenses:Rent

2018-01-12 "Hungry again"
Assets:Checking -200 USD
Expenses:Groceries

2018-01-20 "Something to read"
Assets:Checking -100 USD
Expenses:Books


2018-02-25 "Salary February"
Assets:Checking 4000 USD
Income:Salary

2018-03-01 "Rent March"
Assets:Checking -2000 USD
Expenses:Rent

2018-03-02 "Yet more food"
Assets:Checking -200 USD
Expenses:Groceries

2018-03-20 "More food"
Assets:Checking -400 USD
Expenses:Groceries

2018-03-25 "Salary March"
Assets:Checking 4000 USD
Income:Salary

*** Investments

2018-01-10 "Investing in stock"
Assets:Portfolio +10 AAPL
Assets:Checking -1700 USD
Equity:Gains


** Prices

2018-01-01 price BTC 13412 USD
2018-02-01 price BTC 9052 USD
2018-03-01 price BTC 10907 USD
2018-04-01 price BTC 6816 USD
2018-05-01 price BTC 9067 USD
2018-06-01 price BTC 7518 USD
2018-07-01 price BTC 6347 USD
2018-08-01 price BTC 7603 USD
2018-09-01 price BTC 7192 USD
2018-10-01 price BTC 6578 USD
2018-11-01 price BTC 6358 USD

2018-01-01 price AAPL 169 USD
2018-02-01 price AAPL 167 USD
2018-03-01 price AAPL 175 USD
2018-04-01 price AAPL 166 USD
2018-05-01 price AAPL 169 USD
2018-06-01 price AAPL 190 USD
2018-07-01 price AAPL 185 USD
2018-08-01 price AAPL 201 USD
2018-09-01 price AAPL 227 USD
2018-10-01 price AAPL 225 USD
2018-11-01 price AAPL 222 USD

2018-01-14 "I want to be part of this!"
Assets:Wallet 0.25 BTC
Assets:Checking -3500 USD
Equity:Gains
</pre>

<p>
I am using Emacs with org-mode to manage my journal in one large file
(org-mode titles are treated as comments), however there is an
<code>include</code> directive as well which allows for splitting a journal in
different files.
</p>
</div>
</div>

<div id="outline-container-orgdb1ac4e" class="outline-4">
<h4 id="orgdb1ac4e"><span class="section-number-4">3.2.2</span> Conventions</h4>
<div class="outline-text-4" id="text-3-2-2">
<ul class="org-ul">
<li>Accounts must be opened (and closed, if so desired) explicitly. They
can be open for all commodities (default) or restricted to a list of
them</li>
<li>Account names must start with "Assets", "Liabilities", "Equity",
"Expenses" or "Income", depending on their type.</li>
<li>Transactions need not be ordered, <code>beans</code> automatically orders them by
date.</li>
<li>Transactions with only one commodity can have a 'wildcard' booking,
which is automatically assigned the total of the other bookings
(this is the same as in other plain-text accounting tools)</li>
<li>Unlike <code>beancount</code>, <code>beans</code> uses the convention that <code>balance</code>
directives refer to balances at the end of the given date. This is
congruent with standard practices in the financial industry.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org1499d20" class="outline-3">
<h3 id="org1499d20"><span class="section-number-3">3.3</span> Balancing</h3>
<div class="outline-text-3" id="text-3-3">
</div>
<div id="outline-container-orgfd2c418" class="outline-4">
<h4 id="orgfd2c418"><span class="section-number-4">3.3.1</span> Global balance</h4>
<div class="outline-text-4" id="text-3-3-1">
<p>
In addition to the predefined reports, beans has a generic balancing command:
</p>

<div class="org-src-container">
<pre class="src src-sh" id="org251bddd">beans balance -j examples/example.bean
</pre>
</div>

<p>
This outputs a balance for all accounts without currency
conversions, on the first and last day of the ledger
</p>

<pre class="example">
|------------------+------------+------------|
| Account          | 2018-01-01 | 2018-11-01 |
|------------------+------------+------------|
| Assets           |            |            |
|   Checking       |            |            |
|     USD          |   15000.00 |   14600.00 |
|   Portfolio      |            |            |
|     AAPL         |            |      10.00 |
|   Wallet         |            |            |
|     BTC          |            |       0.25 |
|------------------+------------+------------|
| Equity           |            |            |
|   Gains          |            |            |
|     AAPL         |            |     -10.00 |
|     BTC          |            |      -0.25 |
|     USD          |            |    5200.00 |
|   OpeningBalance |            |            |
|     USD          |  -15000.00 |  -15000.00 |
|------------------+------------+------------|
| Income           |            |            |
|   Salary         |            |            |
|     USD          |            |  -12000.00 |
|------------------+------------+------------|
| Expenses         |            |            |
|   Books          |            |            |
|     USD          |            |     100.00 |
|   Groceries      |            |            |
|     USD          |            |    1100.00 |
|   Rent           |            |            |
|     USD          |            |    6000.00 |
|------------------+------------+------------|
| Total            |            |            |
|   AAPL           |            |            |
|   BTC            |            |            |
|   USD            |            |            |
|------------------+------------+------------|

</pre>

<p>
You want a multi-column balance?
</p>

<div class="org-src-container">
<pre class="src src-sh" id="orgc824b8a">beans balance -j examples/example.bean --interval quarterly
</pre>
</div>

<pre class="example">
|------------------+------------+------------+------------+------------+------------|
| Account          | 2017-12-31 | 2018-03-31 | 2018-06-30 | 2018-09-30 | 2018-12-31 |
|------------------+------------+------------+------------+------------+------------|
| Assets           |            |            |            |            |            |
|   Checking       |            |            |            |            |            |
|     USD          |            |   14600.00 |   14600.00 |   14600.00 |   14600.00 |
|   Portfolio      |            |            |            |            |            |
|     AAPL         |            |      10.00 |      10.00 |      10.00 |      10.00 |
|   Wallet         |            |            |            |            |            |
|     BTC          |            |       0.25 |       0.25 |       0.25 |       0.25 |
|------------------+------------+------------+------------+------------+------------|
| Equity           |            |            |            |            |            |
|   Gains          |            |            |            |            |            |
|     AAPL         |            |     -10.00 |     -10.00 |     -10.00 |     -10.00 |
|     BTC          |            |      -0.25 |      -0.25 |      -0.25 |      -0.25 |
|     USD          |            |    5200.00 |    5200.00 |    5200.00 |    5200.00 |
|   OpeningBalance |            |            |            |            |            |
|     USD          |            |  -15000.00 |  -15000.00 |  -15000.00 |  -15000.00 |
|------------------+------------+------------+------------+------------+------------|
| Income           |            |            |            |            |            |
|   Salary         |            |            |            |            |            |
|     USD          |            |  -12000.00 |  -12000.00 |  -12000.00 |  -12000.00 |
|------------------+------------+------------+------------+------------+------------|
| Expenses         |            |            |            |            |            |
|   Books          |            |            |            |            |            |
|     USD          |            |     100.00 |     100.00 |     100.00 |     100.00 |
|   Groceries      |            |            |            |            |            |
|     USD          |            |    1100.00 |    1100.00 |    1100.00 |    1100.00 |
|   Rent           |            |            |            |            |            |
|     USD          |            |    6000.00 |    6000.00 |    6000.00 |    6000.00 |
|------------------+------------+------------+------------+------------+------------|
| Total            |            |            |            |            |            |
|   AAPL           |            |            |            |            |            |
|   BTC            |            |            |            |            |            |
|   USD            |            |            |            |            |            |
|------------------+------------+------------+------------+------------+------------|

</pre>
</div>
</div>



<div id="outline-container-org05dc090" class="outline-4">
<h4 id="org05dc090"><span class="section-number-4">3.3.2</span> Balancing options</h4>
<div class="outline-text-4" id="text-3-3-2">
</div>
<ol class="org-ol">
<li><a id="org76f5395"></a>Flattening the account structure<br />
<div class="outline-text-5" id="text-3-3-2-1">
<p>
There are some formatting options available:
</p>

<div class="org-src-container">
<pre class="src src-sh" id="org61de07e">beans balance -j examples/example.bean --format flat
</pre>
</div>

<pre class="example">
|-----------------------+------------+------------|
| Account               | 2018-01-01 | 2018-11-01 |
|-----------------------+------------+------------|
| Assets:Checking       |            |            |
|   USD                 |   15000.00 |   14600.00 |
|-----------------------+------------+------------|
| Assets:Portfolio      |            |            |
|   AAPL                |            |      10.00 |
|-----------------------+------------+------------|
| Assets:Wallet         |            |            |
|   BTC                 |            |       0.25 |
|-----------------------+------------+------------|
| Equity:Gains          |            |            |
|   AAPL                |            |     -10.00 |
|   BTC                 |            |      -0.25 |
|   USD                 |            |    5200.00 |
|-----------------------+------------+------------|
| Equity:OpeningBalance |            |            |
|   USD                 |  -15000.00 |  -15000.00 |
|-----------------------+------------+------------|
| Income:Salary         |            |            |
|   USD                 |            |  -12000.00 |
|-----------------------+------------+------------|
| Expenses:Books        |            |            |
|   USD                 |            |     100.00 |
|-----------------------+------------+------------|
| Expenses:Groceries    |            |            |
|   USD                 |            |    1100.00 |
|-----------------------+------------+------------|
| Expenses:Rent         |            |            |
|   USD                 |            |    6000.00 |
|-----------------------+------------+------------|
| Total                 |            |            |
|   AAPL                |            |            |
|   BTC                 |            |            |
|   USD                 |            |            |
|-----------------------+------------+------------|

</pre>
</div>
</li>

<li><a id="orgf0ac76c"></a>Valuation at market prices<br />
<div class="outline-text-5" id="text-3-3-2-2">
<p>
Valuation at market (i.e. latest available prices) is always an option:
</p>

<div class="org-src-container">
<pre class="src src-sh" id="org3b18b56">beans balance -j examples/example.bean --val USD
</pre>
</div>

<pre class="example">
|------------------+------------+------------|
| Account          | 2018-01-01 | 2018-11-01 |
|------------------+------------+------------|
| Assets           |            |            |
|   Checking       |   15000.00 |   14600.00 |
|   Portfolio      |            |    2220.00 |
|   Wallet         |            |    1589.50 |
|------------------+------------+------------|
| Equity           |            |            |
|   Equity         |            |    1233.50 |
|   Gains          |            |     157.00 |
|   OpeningBalance |  -15000.00 |  -15000.00 |
|------------------+------------+------------|
| Income           |            |            |
|   Salary         |            |  -12000.00 |
|------------------+------------+------------|
| Expenses         |            |            |
|   Books          |            |     100.00 |
|   Groceries      |            |    1100.00 |
|   Rent           |            |    6000.00 |
|------------------+------------+------------|
| Total            |            |            |
|------------------+------------+------------|

</pre>
</div>
</li>

<li><a id="org3cfa832"></a>Restricting dates and periods<br />
<div class="outline-text-5" id="text-3-3-2-3">
<p>
We can also analyze changes in the balance between specific dates:
</p>

<div class="org-src-container">
<pre class="src src-sh">beans balance -j examples/example.bean --val USD --from 2018-06-30 --to 2018-10-30
</pre>
</div>

<pre class="example">
|------------------+------------+------------|
| Account          | 2018-06-30 | 2018-10-30 |
|------------------+------------+------------|
| Assets           |            |            |
|   Checking       |   14600.00 |   14600.00 |
|   Portfolio      |    1900.00 |    2250.00 |
|   Wallet         |    1879.50 |    1644.50 |
|------------------+------------+------------|
| Equity           |            |            |
|   Equity         |    1263.50 |    1148.50 |
|   Gains          |     157.00 |     157.00 |
|   OpeningBalance |  -15000.00 |  -15000.00 |
|------------------+------------+------------|
| Income           |            |            |
|   Salary         |  -12000.00 |  -12000.00 |
|------------------+------------+------------|
| Expenses         |            |            |
|   Books          |     100.00 |     100.00 |
|   Groceries      |    1100.00 |    1100.00 |
|   Rent           |    6000.00 |    6000.00 |
|------------------+------------+------------|
| Total            |            |            |
|------------------+------------+------------|

</pre>
</div>
</li>

<li><a id="org2be891d"></a>Analyzing changes in valuation<br />
<div class="outline-text-5" id="text-3-3-2-4">
<p>
Using filtering, we can eliminate the effect of income and expenses
and track valuation changes over the entire period:
</p>

<div class="org-src-container">
<pre class="src src-sh">beans balance -j examples/example.bean --account-filter Equity --val USD
</pre>
</div>

<pre class="example">
|------------------+------------+------------|
| Account          | 2018-01-01 | 2018-11-01 |
|------------------+------------+------------|
| Assets           |            |            |
|   Checking       |   15000.00 |    9800.00 |
|   Portfolio      |            |    2220.00 |
|   Wallet         |            |    1589.50 |
|------------------+------------+------------|
| Equity           |            |            |
|   Equity         |            |    1233.50 |
|   Gains          |            |     157.00 |
|   OpeningBalance |  -15000.00 |  -15000.00 |
|------------------+------------+------------|
| Total            |            |            |
|------------------+------------+------------|

</pre>

<p>
How about bitcoin?
</p>

<div class="org-src-container">
<pre class="src src-sh" id="orgb65181a">beans balance -j examples/example.bean --val BTC
</pre>
</div>

<pre class="example">
|------------------+------------+------------|
| Account          | 2018-01-01 | 2018-11-01 |
|------------------+------------+------------|
| Assets           |            |            |
|   Checking       |       1.12 |       2.30 |
|   Portfolio      |            |       0.35 |
|   Wallet         |            |       0.25 |
|------------------+------------+------------|
| Equity           |            |            |
|   Equity         |            |      -1.34 |
|   Gains          |            |       0.01 |
|   OpeningBalance |      -1.12 |      -1.12 |
|------------------+------------+------------|
| Income           |            |            |
|   Salary         |            |      -1.11 |
|------------------+------------+------------|
| Expenses         |            |            |
|   Books          |            |       0.01 |
|   Groceries      |            |       0.09 |
|   Rent           |            |       0.55 |
|------------------+------------+------------|
| Total            |       0.00 |       0.00 |
|------------------+------------+------------|

</pre>

<p>
<code>beans</code> derives arbitrary commodity conversions between all
commodities, as long as there is at least one path (possibly over
several links) from one commodity to another. For example, conversion
from SomeStock in CHF is possible when prices of SomeStock in USD and
CHF in USD is available. Inverted rates are derived automatically.
</p>

<p>
At the moment, beans offers either no valuation or valuation at market
prices. Valuation at cost is yet to be implemented.
</p>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-orgfcd34fe" class="outline-3">
<h3 id="orgfcd34fe"><span class="section-number-3">3.4</span> Transaction-level valuation</h3>
<div class="outline-text-3" id="text-3-4">
<p>
beans applies valuation at the level of transactions, which seems
unique amongst plain-text accounting tools. In the examples above, if
a conversion to a common commodity is desired, beans will:
</p>

<ul class="org-ul">
<li>convert all bookings over the entire ledger to that commodity at
market value (given by the transitive &amp; reflexive closure of price
directives at the transaction date),</li>

<li>insert valuation bookings for the accumulated positions of all asset
and liability accounts whenever prices change. These adjustment are
balanced against an Equity:Valuation account, which is hard-coded
for the moment.</li>
</ul>

<p>
Every difference in value of an account over a period is explicitly
modeled by corresponding valuation transactions. This greatly
facilitates introspection and analysis, as every unit of the valuation
commodity can be accounted for explicitly.
</p>
</div>
</div>
</div>


<div id="outline-container-orgefc2788" class="outline-2">
<h2 id="orgefc2788"><span class="section-number-2">4</span> Developing beans</h2>
<div class="outline-text-2" id="text-4">
<p>
Development is very much in progress and beans is not really stable
yet. It seems though that the basic pipeline (importing -
categorizing - balancing) is there, and I am using it to balance my
own journal. beans development is at the moment entirely driven by my
own needs. It has also been a playground for experiments and lots of
refactoring for fun with Haskell.
</p>

<p>
Use beans at your own risk - at the moment, it is certainly
advantageous if you know some Haskell.
</p>
</div>

<div id="outline-container-orgd8a6da9" class="outline-3">
<h3 id="orgd8a6da9"><span class="section-number-3">4.1</span> Roadmap</h3>
<div class="outline-text-3" id="text-4-1">
<p>
<code>beans</code> still has long way to go. I do this in my spare time and I do
not have an explicit road map, but here are some ideas I'd like to be
working on in the future:
</p>
</div>

<div id="outline-container-orgacd6c94" class="outline-4">
<h4 id="orgacd6c94"><span class="section-number-4">4.1.1</span> Shorter term</h4>
<div class="outline-text-4" id="text-4-1-1">
<ul class="org-ul">
<li class="on"><code>[X]</code> new command to print and filter transactions (as-is or at market value)</li>
<li class="off"><code>[&#xa0;]</code> provide a more realistic example file</li>
<li class="on"><code>[X]</code> multi-period reports (yearly, monthly, weekly, daily, &#x2026;)</li>
<li class="off"><code>[&#xa0;]</code> colored output</li>
<li class="off"><code>[&#xa0;]</code> friendlier command line</li>
<li class="off"><code>[&#xa0;]</code> more importers (I'll do those that I need personally, but I am
happy to receive contributions if they are provided with a sample
file / test)</li>
<li class="on"><code>[X]</code> export to other tools (beancount / <del>hledger</del> / <del>ledger</del>)</li>
</ul>
</div>
</div>

<div id="outline-container-orgcb991d2" class="outline-4">
<h4 id="orgcb991d2"><span class="section-number-4">4.1.2</span> Longer term</h4>
<div class="outline-text-4" id="text-4-1-2">
<ul class="org-ul">
<li class="off"><code>[&#xa0;]</code> general reporting infrastructure</li>
<li class="off"><code>[&#xa0;]</code> more reports (income statement, cash flow statement)</li>
<li class="off"><code>[&#xa0;]</code> plotting / graphs</li>
<li class="off"><code>[&#xa0;]</code> portfolio performance calculation</li>
<li class="off"><code>[&#xa0;]</code> more UI options (web, terminal)</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org02dbe78" class="outline-3">
<h3 id="org02dbe78"><span class="section-number-3">4.2</span> Documentation</h3>
<div class="outline-text-3" id="text-4-2">
<p>
This manual aims to provide a comprehensive overview of its
functionality. It is written in <a href="https://orgmode.org">org-mode</a>, please file a pull request
against <a href="https://github.com/sboehler/beans/blob/master/index.org">this file</a> if you want to contribute.
</p>
</div>
</div>

<div id="outline-container-org85c3215" class="outline-3">
<h3 id="org85c3215"><span class="section-number-3">4.3</span> Dev setup</h3>
<div class="outline-text-3" id="text-4-3">
</div>
<div id="outline-container-org976e2aa" class="outline-4">
<h4 id="org976e2aa"><span class="section-number-4">4.3.1</span> nix / Haskell IDE engine</h4>
<div class="outline-text-4" id="text-4-3-1">
<p>
I am using Emacs and <a href="https://github.com/digital-asset/ghcide">ghcide</a> under <a href="https://nixos.org/">Nixos</a>. To setup your
development environment and install all dependencies, simply run
</p>

<pre class="example">
nix-shell
</pre>

<p>
if you have the nix package manager installed.
</p>
</div>
</div>

<div id="outline-container-org70f6d49" class="outline-4">
<h4 id="org70f6d49"><span class="section-number-4">4.3.2</span> Stack</h4>
<div class="outline-text-4" id="text-4-3-2">
<p>
It should be possible to develop <code>beans</code> with stack. Please file a bug
report / pull request if you discover anything that does not work as
expected.
</p>
</div>
</div>
</div>

<div id="outline-container-org0392c3c" class="outline-3">
<h3 id="org0392c3c"><span class="section-number-3">4.4</span> Adding an importer</h3>
<div class="outline-text-3" id="text-4-4">
<p>
<code>beans</code> is open to contributions, see the example <a href="https://github.com/sboehler/beans/blob/master/src/Beans/Import/CH/Postfinance.hs">here</a> how an importer
can be implemented. The directory should match the country of the
bank. Make a pull request if you want to have it included in beans
(preferrably with a test case and an anonymized sample file).
</p>

<p>
It is still an open question whether importers should be included in
the <code>beans</code> repository or whether a more modular system should be
adopted. I am open to suggestion.
</p>
</div>
</div>

<div id="outline-container-org03c641e" class="outline-3">
<h3 id="org03c641e"><span class="section-number-3">4.5</span> Tests</h3>
<div class="outline-text-3" id="text-4-5">
<p>
Every importer should have a test and an example file. This being
said, test coverage is currently lacking for the existing importers.
</p>
</div>
</div>
</div>


<div id="outline-container-orgb33a99d" class="outline-2">
<h2 id="orgb33a99d"><span class="section-number-2">5</span> License</h2>
<div class="outline-text-2" id="text-5">
<p>
<code>beans</code> is licensed under the BSD-3 license.
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Silvio BÃ¶hler</p>
<p class="date">Created: 2020-06-04 Do 22:13</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
